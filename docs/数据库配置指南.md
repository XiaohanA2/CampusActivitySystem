# 数据库配置指南

## 概述
校园活动管理系统使用MySQL数据库存储数据。本文档介绍如何配置和初始化数据库。

## 数据库连接信息
- **主机**: 117.72.111.42
- **端口**: 3306
- **数据库名**: CampusActivityDB
- **用户名**: root
- **密码**: tj123456

## 数据库初始化步骤

### 方法一：使用MySQL客户端工具

1. **安装MySQL客户端工具**
   - 下载并安装MySQL Workbench、Navicat、phpMyAdmin等工具
   - 或者安装MySQL命令行客户端

2. **连接到数据库**
   ```
   主机: 117.72.111.42
   端口: 3306
   用户名: root
   密码: tj123456
   ```

3. **执行初始化脚本**
   - 打开 `docs/数据库初始化脚本.sql` 文件
   - 在MySQL客户端中执行该脚本
   - 脚本会自动创建所有必要的表和示例数据

### 方法二：使用命令行（需要MySQL客户端）

1. **检查MySQL客户端是否安装**
   ```bash
   mysql --version
   ```

2. **执行初始化脚本**
   ```bash
   mysql -h 117.72.111.42 -P 3306 -u root -ptj123456 < docs/数据库初始化脚本.sql
   ```

3. **验证数据库状态**
   ```bash
   mysql -h 117.72.111.42 -P 3306 -u root -ptj123456 CampusActivityDB -e "SHOW TABLES;"
   ```

### 方法三：通过应用程序自动初始化

1. **启动WebAPI服务**
   ```bash
   cd src/CampusActivity.WebAPI
   dotnet run
   ```

2. **启动Blazor应用**
   ```bash
   cd src/CampusActivity.BlazorWeb
   dotnet run
   ```

3. **访问应用程序**
   - 打开浏览器访问 https://localhost:7001
   - 登录系统后，日程表功能会自动检查数据库状态

## 数据库表结构

### 主要表
- `Users` - 用户表
- `Activities` - 活动表
- `ActivityCategories` - 活动分类表
- `ActivityRegistrations` - 活动报名表
- `ScheduleItems` - 日程表项表（新增）
- `ActivityTags` - 活动标签表
- `ActivityRecommendations` - 活动推荐表
- `UserActivityPreferences` - 用户活动偏好表

### 日程表结构 (ScheduleItems)
```sql
CREATE TABLE ScheduleItems (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    UserId INT NOT NULL,
    Title VARCHAR(200) NOT NULL,
    Description VARCHAR(1000),
    Location VARCHAR(200),
    StartTime DATETIME NOT NULL,
    EndTime DATETIME NOT NULL,
    Type INT NOT NULL DEFAULT 1,
    Priority INT NOT NULL DEFAULT 2,
    Color VARCHAR(7),
    IsCompleted BOOLEAN NOT NULL DEFAULT FALSE,
    Note VARCHAR(500),
    ActivityId INT NULL,
    CreatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UpdatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    IsDeleted BOOLEAN NOT NULL DEFAULT FALSE
);
```

## 验证数据库状态

### 检查表是否存在
```sql
SELECT COUNT(*) as TableExists 
FROM information_schema.tables 
WHERE table_schema = 'CampusActivityDB' AND table_name = 'ScheduleItems';
```

### 检查日程表数据
```sql
SELECT COUNT(*) as ScheduleItemsCount 
FROM ScheduleItems 
WHERE IsDeleted = FALSE;
```

### 查看示例数据
```sql
SELECT Id, UserId, Title, StartTime, EndTime, Type, Priority, IsCompleted 
FROM ScheduleItems 
WHERE IsDeleted = FALSE 
ORDER BY StartTime 
LIMIT 10;
```

## 常见问题

### 1. 连接数据库失败
- 检查网络连接
- 确认数据库服务器是否运行
- 验证用户名和密码是否正确

### 2. 表不存在
- 执行数据库初始化脚本
- 检查SQL脚本是否有语法错误
- 确认数据库权限

### 3. 日程表功能无法使用
- 确认 `ScheduleItems` 表已创建
- 检查表结构是否正确
- 验证示例数据是否已插入

## 联系支持
如果遇到数据库配置问题，请检查：
1. 数据库连接信息是否正确
2. 网络连接是否正常
3. 数据库服务器是否运行
4. 用户权限是否足够